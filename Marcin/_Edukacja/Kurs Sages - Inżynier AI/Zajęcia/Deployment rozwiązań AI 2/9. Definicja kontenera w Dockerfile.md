# Definicja kontenera w Dockerfile

Skoro Wiemy już Czym jest kontener,  to teraz porozmawiaj sobie jak go stworzyć.  Tak naprawdę w przypadku budowy kontara z wykorzystaniem technologii Docker będzie opierał się tylko i wyłącznie o dwa pliki `Dockerfile` oraz `.dockerignore`.

Otwórzmy sobie Dockerfile i omówmy sobie krok po kroku to co się w nim dzieje.

1. `FROM python:3.11-slim-bullseye` - Każdy Dockerfile, Czyli plik specyfikujący proces budowy naszego kontenera, zawsze zaczyna się od `FROM` - Istnieje oczywiście pewien wyjątek ale to pokażę wam później. Teraz co oznacza ta instrukcja `FROM`. Ta instrukcja FROM oznacza bazowy kontener, na podstawie którego będzie budowany nasz kontener. Teraz żeby wyjaśnić wam czym może być ten bazowy kontener. Przejdźmy sobie do naszego Docker Hub. Docker Hub to nic innego jak repozytorium kontenerów. Wejdźmy sobie w zakładkę Explore I zobaczmy co mamy. Mamy obraz Ubuntu,  czyli systemu operacyjnego z którego teraz korzystamy, ale ten kontener z Ubuntu na przykład nie posiada tego interfejsu graficznego, tylko sam terminal. Mamy naszego Pythona, którego my w tym naszym kontenerze użyjemy.  Mamy też redisa i postgressa czyli bazy danych które my  używamy  na naszych zajęciach. I tak naprawdę te komendy `make postgres` i `make redis` które używaliście wcześniej To nic innego jak przygotowane skrypty w bashu napisane przeze mnie, których zdaniem było pobranie obrazów i uruchomienie ich lokalnie. W ten sposób deployowałem sobie tę bazę danych po to żeby można było z nich korzystać. Jak widzicie w tym repozytorium znajdują się kontenery które każdy z was może pobrać użyć go takim jakim już jest zdefiniowany,  albo pobierzemy go i możemy go odpowiednio zmodyfikować na nasze potrzeby. I do tego właśnie służy klauzula FROM.  czyli ja definiując `FROM python:3.11-slim-bullseye` Określa że stuckerhaba Pobieram kontener Python  w wersji 3.11. I dalsza specyfikacja Określa bardziej szczegółowy typ tego kontenera o czym powiemy sobie troszeczkę później.  na ten moment zostajemy przy wersji pobieramy  kontener z Pythonem 3.11.
    
Teraz pytanie jakie musisz sobie zadać to po co to robimy? Można zbudować kontener zaczynając od pustego kontenera.  czyli ja mógłbym napisać zamiast `FROM python:3.11-slim-bullseye` moge napisać `FROM scratch`. Czyli Startuje z pustym kontenerem.  dalej musiałbym zainstalować w środowisku mojego Pythona,  dodatkowe inne jeszcze rzeczy i Niezbędne były do prawidłowego funkcjonowania i tak dalej i tak dalej. Musiałbym się sporo napracować.  aby tego uniknąć Ja w swojej definicji jak norma powstać zaczynam od tego Aby zdefiniować ten kontener na którym będę go budował.  ty w tym wypadku Pobieram sobie naszego Pythona 3.11 Po to aby skorzystać już z tego co w tym kontorze Python 3.11 jest już dostępne. Ja nie muszę zrobić tego ręcznie,  samemu wszystko instalować i konfigurować. I tak w rzeczywistości by wygląda budowa jakby kontenerów ona zaczynają się od pobrania jakiegoś bazowego obrazu,  na którym cały proces  budowy waszego kontenera bazuje. Teraz dlaczego jest to możliwe,  Dlaczego mogę skorzystać z innego konta nara żeby Zbudować swój kontener powiemy sobie troszeczkę później W tematach już bardziej zaawansowanych przy omówieniu warstw w dockerze. Na ten moment from oznacza  bazę/fundament na którym będzie opierał się wasz kontener.

2. `WORKDIR /app` - Drugą komendę którą tutaj określamy jest nasz workdir Które określa nam folder roboczy w naszym kontenerze.  oznacza to że wszelkie dalsze instrukcje zdefiniowane w Dockerfile i wykonywane po tym WORKDIR, będą wykonywane w tym folderze. Ustawienia workdira jest bardzo ważne, bo możesz sobie popsuć kontener pokażę wam później dlaczego. 
3. `COPY . .` - Kolejną komendą którą mamy jest `COPY . .`  która jest trochę nieczytelna.  Ale metoda kopii głównie opiera się właśnie o dwa argumenty.  Po pierwsze co kopiujemy  i gdzie to kupiłem. Czyli w naszym przypadku zadziała to taki sposób że do kontenera skopiujemy sobie wszystko to co znajduje się w obecnym folderze w którym zaczniemy budować kontenera -  i to jest ta pierwsza. A druga  oznacza lokalizacje w kontenerze gdzie to mamy skopiować - W tym przypadku kropka oznaczać będzie do obecnego WORKDIRA które jest ustawiony. Czyli w tym przypadku Skopiuj wszystko co znajduje się w folderze,  w którym zaczniemy budowę kontenera, do folderu `/app` w kontenerze. 
4. `RUN pip install -r requirements.txt` - Dalsza komenda RUN Oznacza to Jaką komendę chcemy uruchomić w kontenerze podczas jego budowy. Jak już mamy wszystko,  czyli mamy Pythona 311 dlatego że budujemy kontener na podstawie obrazu Python 311,  skopiowaliśmy sobie wszystkie nasze pliki które mamy w naszym  w projekcie, To teraz musimy zainstalować te biblioteki w kontenerze abyśmy mogli uruchomić nasze API. Musimy to zrobić ponieważ ten kontener python 3.11 z instrukcji FROM Ma w sobie zainstalowane tylko bazowe biblioteki,  czyli musicie sobie to wyobrazić tak jakbyście pracowali na czystym, nowo postawionym środowisku, Wzór macie tylko i wyłącznie właśnie bazowe biblioteki.  żeby nasze Apis zadziałało musimy zainstalować to co potrzebujemy zatem uruchamiamy pip install requirements.
5. Po zainstalowaniu musimy określić naszą zmienną środowiskową która wskazuje nam na to Gdzie znajduje się nasze środowisko pythonowe. W naszym przypadku wszystko siedzi w folderze `/app` Zatem te miejsce wskazujemy jako miejsce gdzie znajduje sie nasz Python interpreter. Gdybyśmy tej zmiennej środowiskowej nie ustawili to domyślnie szuka on Pythonowego interpretera w lokalizacji `/usr/local/` (TODO: sprawdz czy to jest w kontenerze)
6. `EXPOSE 8080` - Następnie w API określiliśmy że nasze API działa na porcie 8080. Wiem że o temacie portów Jeszcze nie rozmawialiśmy.  ale dzisiaj już będziemy rozmawiać bo Powolutku będziemy przychodzić na chmurę i w związku z tym pewne tematy sieciowe trzeba będzie poruszyć i zrozumieć.  Na ten moment expose 8080 zostawiamy I powiemy o nim sobie troszeczkę później. 
7. `CMD python src/service/main.py` - I ostatni element który kończy dockerfile,  jest komenda która zostanie uruchomiona w momencie kiedy nasz nasz kontener zostanie uruchomiony. Czyli wszystko od początku do instrukcji `CMD` Jest uruchamiane w procesie budowy kontenera, A z kolei CMD określa to co zostanie uruchomione w kontenerze w momencie kiedy będziemy chcieli go uruchomić. Żebyśmy mogli uruchomić daną aplikację w izolowanym środowisku,  który sobie właśnie tutaj zdefiniowaliśmy naszą instrukcjami. W naszym przypadku naszą aplikacją jest nasze API do modeli. Zatem CMD będzie oznaczał  komendę która pozwoli na nasze API uruchomić, Czyli w tym przypadku będzie to wywołanie skryptu mainby korzystając z pythona Ty to co do tej pory robiła nasza komenda `make api`. 

Opis działania pierwszego Dockerfile który tutaj widzicie omówiłem sposób dosyć ogólny,  bez wchodzenia w niektóre niuanse i szczegóły. Tak jak powiedziałem będziemy przechodzić od ogółu do szczegółu, od rzeczy prostych do rzeczy trudniejszych I tak naprawdę cały nasz zjazd weekendowy będzie polegał na ciągłym poprawianiu Dockerfile. Więc jeżeli na ten moment pewne instrukcje są dla Was jeszcze nie do końca jasne, to spokojnie - to jest Wasz pierwszy kontakt z Dockerem i my przez cały weekend będziemy w tego Dockerfile patrzyć non stop, te instrukcje budowy kontenera będziemy wałkować cały weekend, więc w końcu wejdzie to w krew. I wraz z kolejnymi tematami będziemy coraz mocniej wchodzić w  instrukcję zawarte w Dockerfile, więc wszystko dla Was z biegiem czasu wyda się oczywiste i jasne. Gneralnie budowa kontenera pod względem ilości kodu jest dosyć Prosta,  tutaj mamy 7 linijek kodu I sprawa jest załatwiona.  natomiast jak się potem przekonacie każda linijka kodu robi Naprawdę bardzo dużo I kolejność Ułożenia instrukcji w Dockerfile Też jest bardzo istotna.  Więc pomimo tego że docker-file zajmować będą małą ilość kodu to jednak pisanie ich w sposób efektywny jest trudne. 

Ale może jakieś pytania macie tego co powiedziałem do tej pory?