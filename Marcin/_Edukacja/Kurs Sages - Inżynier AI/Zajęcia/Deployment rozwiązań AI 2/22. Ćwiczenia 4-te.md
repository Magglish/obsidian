# Ćwiczenia 4-te

Stworzenie dedykowanego obrazu z redisem:

1. Przeanalizujcie skrypt `run_redis.sh`
2. Stwórzcie dedykowany Dockerfile w `deploy/docker/redis`
3. Zaimplementujcie go
4. Zbudujcie obraz i wyślijcie go do repo `magglish/inzynier-ai-live-coding:postgres`
5. Zmodyfikujcie skrypt `run_redis.sh` aby pobrał nowy obraz i uruchomił go.
6. Usuń zbędny kod (jeśli istnieje) z `run_redis.sh`.


### Rozwiązanie zadania, gdyby grupa utknęła




**CAŁY SKRYPT POWINIEN WYGLĄDAC TAK:**


```bash
#!/bin/bash  
  
set -euo pipefail  
  
REDIS_IMAGE="magglish/inzynier-ai-live-coding:redis"  
HOST="127.0.0.1"  
PORT=6379  
  
echo "Pulling $REDIS_IMAGE"  
docker pull "$REDIS_IMAGE"  
echo "$REDIS_IMAGE successfully pulled"  
echo "Checking if anything is already running on $HOST:$PORT"  
container_id=$(docker ps -f "expose=$PORT" --format "{{.ID}}")  
if [[ -n "$container_id" ]]  
then  
    echo "$HOST:$PORT is occupied by a container - killing it."    docker kill "$container_id"  
else  
    echo "Nothing is running on $HOST:$PORT"  
fi  
  
echo "Running $REDIS_IMAGE on $HOST:$PORT"  
redis_container_id=$(docker run \  
  -d \  -p $PORT:$PORT \  "$REDIS_IMAGE")  
  
echo "Waiting 5 seconds for redis to start up"  
sleep 5  
  
echo "Checking if we can connect to redis on $HOST:$PORT"  
response=$(redis-cli -h $HOST -p $PORT ping)  
if [ "$response" == "PONG" ]; then  
  echo "Success - we can connect to redis on $HOST:$PORT"  
else  
  echo "Fail - we can't connect to redis on $HOST:$PORT"  
  echo "$response"  
  docker kill "$redis_container_id"  
  exit 1  
fi  
  
echo "Everything done - redis is listening on $HOST:$PORT"
```